
## Azure Durable function
- Could be long-running Or a multi-step process
- stateful worflow by writing orchestrator functions.
- Can "Suspend" while waiting for a long-running API to return - checkpoints
- Supports complex design patterns
- Functions can call other functions - chaining
- Made up of a client, orchestrator and activities.


The client is just like simple function trigger likes (Http, Timer trigger) which makes the function up and running. It typically setup the orchestrator, orchestrator are like a traffic cop it makes muliple things to happen in order. You have to write the code for the orchestration. Activity is basically does the work of a function.

### Primary Usecase:
Durable functions is simplying complex, stateful coordination requirements in serverless applications.
**`Typical application pattens`**
- `Function chaining` Serious functions are executed in a specific order F1,F2,F3 output of F1 can be input to F2. Code executed top down.
- `Fan-out/Fan-in` Functions are executed in parallel and then wait for all function to finish. Often, some aggregation work is done on the results
- `Async HTTP APIs` An HTTP endpoint trigger the long-running action. Then redirect the client to a staus endpoint that the client polls to learn when the operation is finished.
  -  Build-in supports are available.
- `Monitor`. Patterns refer a flexible, recurring process in a workflow. Regular timer trigger to cleanup 
- `Human interaction` The orchestrator uses a durable timer to request approval. The orchestrator escalates if timeout occurs. The orchestrator waits for an external event, such as a notification that's generated by a human interaction.

### Four functions types:
1. `Orchestration functions:` 
   - Describes how actions are executed and the order in which actions are executed.
   - Can include many actions, incl activity functions, sub activity functions, sub-orchestrations, waiting for the external HTTP, and timers.
2. `Activity functions:`
   - Basic unit of work in a durable function orchestration
   - (e.g) Process an order the task involved like checking inventory, charging customer, and creating shipments each task can be am activity function.
   - An activity trigger is used to define an activity function.
3. `Entity functions:`
   - Entity functions define operation for reading and updating small piece of state.
   - Contains entity trigger
   - Invoked from client or orchestrator functions
   - no specific code constraints
   - Manages the state explicitly rather than implicitly.
   - Entities are accessed using Unique String identifier
   - Operation on entities requires the Entity ID and the operation name.
4. `Client functions:`
   Any Non-orchestrator functions can be a client function (e.g) HTTP triggered function, an Azure Eventhub triggered function. Its the non durable client output binding makes a client function.

   Orchestrator ans entity functions are triggered by their bindings and both of these triggers work by reacting to the messages that are enqueued in a task hub. The primary way to deliver these messages is by using orchestrator client binding, or an entity binding from within a client function. (e.g) HTTP-triggered function, an Azure Event Hub triggered functions. 
   
   ## Explore Taskhub
   - Taskhub are the logical container for durable storage resources that are used for orchestrations and entities. Direct interaction between Orchestrator, Activity, entity function is possible if they belong to same Taskhub.
   - If muliple function apps share a storage account, each must have a separate task hub name.

Following resources are created automatically configured in Azure storage account when orchestrator, entity, or activity functions run or scheduled to run. 
 1 or more queue
 1 work-item queue
 1 history table 
 1 instance table 
 1 storage container containing one or more lease blobs.
 1 storage container containing large message payloads, if applicable.

## Exploring durable orchestrations
- Defines function flow using procedural code. No declartive schema or designers required.
- Can call other durable functions syc/async. Output from called functions are stored to local variable
- They are durable and reliable. Execution progress is automatically checkpointed as and when the functions "awaits" or "yields"
- It can be a long-running for days, month and never ending.
- Each durable orchestrations by default has unique Orchestration ID.
   
